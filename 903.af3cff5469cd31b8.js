"use strict";(self.webpackChunkangular_movies=self.webpackChunkangular_movies||[]).push([[903],{8903:(S,l,n)=>{n.r(l),n.d(l,{TopMoviesModule:()=>f});var a=n(6895),h=n(3900),e=n(8256),v=n(4004),d=n(262),p=n(529);let g=(()=>{class o{constructor(t){this.http=t,this.apiKey="b4016224ea90dc523669a794dc2764e4",this.baseUrl=`https://api.themoviedb.org/3/discover/movie?api_key=${this.apiKey}`}getTopMovies(){return this.http.get(`${this.baseUrl}&language=pt-BR&region=BR&sort_by=popularity.desc&include_adult=false&include_video=false&page=1&vote_count.gte=1000`).pipe((0,v.U)(t=>t.results),(0,v.U)(t=>t.map(i=>({...i,posterUrl:`https://image.tmdb.org/t/p/w185${i.poster_path}`}))),(0,d.K)(t=>(console.error("Erro ao buscar os filmes:",t),[])))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(p.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),M=(()=>{class o{constructor(t){this.http=t}likeMovie(t,i){const r=(new p.WM).set("Authorization",`Bearer ${i}`);return this.http.post("http://146.190.145.3/likes/like",{movieId:t},{headers:r})}dislikeMovie(t,i){const r=(new p.WM).set("Authorization",`Bearer ${i}`);return this.http.post("http://146.190.145.3/likes/dislike",{movieId:t},{headers:r})}getLikedMovies(t){const i=(new p.WM).set("Authorization",`Bearer ${t}`);return this.http.get("http://146.190.145.3/likes",{headers:i})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(p.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var u=n(9833);function m(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li"),e._UZ(1,"img",1),e.TgZ(2,"h3"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.qZA(),e.TgZ(8,"button",2),e.NdJ("click",function(){const c=e.CHM(t).$implicit,T=e.oxw();return e.KtG(T.toggleLike(c.id))}),e._uU(9),e.qZA()()}if(2&o){const t=s.$implicit;e.xp6(1),e.Q6J("src",t.posterUrl,e.LSH),e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Oqu(t.release_date),e.xp6(2),e.Oqu(t.overview),e.xp6(2),e.hij(" ",t.liked?"Liked":"Like"," ")}}let k=(()=>{class o{constructor(t,i,r){this.moviesService=t,this.likeService=i,this.router=r,this.topMovies=[]}ngOnInit(){this.loadMovies()}loadMovies(){const t=sessionStorage.getItem("token")||"";t?this.moviesService.getTopMovies().pipe((0,h.w)(i=>(this.topMovies=i,this.likeService.getLikedMovies(t)))).subscribe({next:i=>{this.topMovies.forEach(r=>{r.liked=i.includes(r.id.toString())})},error:i=>this.redirectToLogin(i)}):this.router.navigate(["/login"])}toggleLike(t){const i=sessionStorage.getItem("token")||"";this.topMovies.find(c=>c.id===t)?.liked?this.likeService.dislikeMovie(t,i).subscribe({next:()=>this.loadMovies(),error:c=>this.redirectToLogin(c)}):this.likeService.likeMovie(t,i).subscribe({next:()=>this.loadMovies(),error:c=>this.redirectToLogin(c)})}redirectToLogin(t){console.error("Erro na requisi\xe7\xe3o POST:",t),this.router.navigate(["/login"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g),e.Y36(M),e.Y36(u.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-top-movies"]],decls:4,vars:1,consts:[[4,"ngFor","ngForOf"],["alt","P\xf4ster",3,"src"],[3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"h2"),e._uU(1,"Top 10 Filmes do Brasil"),e.qZA(),e.TgZ(2,"ul"),e.YNc(3,m,10,5,"li",0),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngForOf",i.topMovies))},dependencies:[a.sg]}),o})(),f=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[a.ez,u.Bz.forChild([{path:"",component:k}])]}),o})()}}]);